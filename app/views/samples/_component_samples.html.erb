<%= panel do %>
  <h3>
    Component Samples <%= counter_badge sample.component_samples.count %>
  </h3>

  <% page     = (params[:page] || 1).to_i %>
  <% per_page = 25 %>
  <% offset   = (page - 1) * per_page %>

  <% paginated_samples = sample.component_samples[offset, per_page] || [] %>

  <table width='100%'>
    <thead>
      <tr>
        <th width='70%'></th>
      </tr>
    </thead>
    <tbody>
      <% paginated_samples.each do |cs| %>
        <tr>
          <td>
            <%= link_to "Sample #{cs.id}", sample_path(cs) %>
            <%= cs.name || 'Un-named' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <style>
    .pagination {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 0.3rem;
    }

    .pagination .page-link,
    .pagination .page-current {
      padding: 0.4rem 0.9rem;
      border-radius: 6px;
      text-decoration: none;
    }

    .pagination .page-link {
      border: 1px solid #ccc;
      background: #f9f9f9;
      color: #333;
    }

    .pagination .page-current {
      border: 1px solid #333;
      background: #333;
      color: #fff;
    }

    .pagination .jump-form {
      display: flex;
      justify-content: center;
      gap: 0.3rem;
      flex-wrap: wrap;
      align-items: center;
      margin-left: 0;
      margin-top: 0.6rem;
      width: 100%; 
    }

    .pagination .page-input {
      width: 60px;
      padding: 0.3rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .pagination .go-btn {
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
  </style>

  <%# --- Pagination links --- %>
  <div class="pagination">
    <% total_pages = (sample.component_samples.count.to_f / per_page).ceil %>
    <% window_size = 5 %>
    <% start_page = [page - 2, 1].max %>
    <% end_page = [start_page + window_size - 1, total_pages].min %>
    <% start_page = [end_page - window_size + 1, 1].max %>

    <%# Previous link %>
    <% if page > 1 %>
      <%= link_to "←", params.merge(page: page - 1), class: "page-link" %>
    <% end %>

    <%# Sliding page number links %>
    <% (start_page..end_page).each do |p| %>
      <% if p == page %>
        <span class="page-current"><%= p %></span>
      <% else %>
        <%= link_to p, params.merge(page: p), class: "page-link" %>
      <% end %>
    <% end %>

    <%# Next link %>
    <% if page < total_pages %>
      <%= link_to "→", params.merge(page: page + 1), class: "page-link" %>
    <% end %>

    <%# Jump to page box with clickable first and last page %>
    <form method="get" class="jump-form">
      <% params.except(:page).each do |k, v| %>
        <input type="hidden" name="<%= k %>" value="<%= v %>">
      <% end %>
      <input type="number" name="page" min="1" max="<%= total_pages %>" value="<%= page %>" class="page-input">
      <span>of <%= total_pages %></span>
      <button type="submit" class="go-btn">Go</button>
    </form>
  </div>
<% end %>
<%  %>