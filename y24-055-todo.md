## TODOs for Y24-055

- [x] Task 1: Rename heading: "Library Plate", to "Library plate - custom tags" in `config/sample_manifest_excel/manifest_types.yml`

- [x] Task 2a: Add a new manifest type in `config/sample_manifest_excel/manifest_types.yml` (Similar to `plate_chromium_library`)

  - heading: "Library plate - dual index tag plate"
  - key: "plate_dual_index_tag_library" ??
  - columns:
    - dual_index_tag_set
    - dual_index_tag_well

- [x] Task 2b: 2a Tests in `spec/data/sample_manifest_excel/manifest_types.yml`

- [x] Task 3a: Add new columns in `config/sample_manifest_excel/columns.yml`

  - called `dual_index_tag_set` with range `dual_index_tag_sets`
  - called `dual_index_tag_well`

- [x] Task 3b: 3a Tests `spec/data/sample_manifest_excel/columns.yml`

- [x] Task 4a: Add new `dual_index_tag_sets` range in `config/sample_manifest_excel/ranges.yml`

  - scope: :dual_index_tag_sets
  - scope_on: TagSet

- [x] Task 4b: 4a Tests `spec/data/sample_manifest_excel/ranges.yml`

- [x] Task 5a: Tag Set model in `app/models/tag_set.rb`

  - (Tag Sets link together two related tag groups, but it can also be used to represent single index tag sets)
  - New method / scope called `dual_index_tag_sets` to filter only Dual Index Tag Sets
  - AND visible?
  - Option 1: Filter tag sets which have both a tag_group and tag2_group
  - Option 2: ?

- [x] Task 5b: 5a Tests `spec/models/tag_set_spec.rb`

- [x] Task 6a: Specialised fields

  - Create two new specialised fields files for `dual_index_tag_set` and `dual_index_tag_well`
  - `dual_index_tag_set` - Check the Tag Set exists, and that it has at least 1 tag group
  - `dual_index_tag_well`
    - Check tag set has two tag groups
    - check each tag group has a tag in the given well
  - Tests

- [x] Task 6b: Specialised fields

  - on update, get the tag from each tag group well, and associate it with the sample in the plates well
  - so that after manifest upload, the sample has two tags associated with it
  - check against manufactor tag name specs with tags

- [ ] Task 7: Well input validation

  - Add validation to well input, so to only allow one letter (A-H) then 1 or 2 numbers (0-9)
  - On upload, there is validation as the tag can't be found if there is an invalid well location (`well_index`)
  - But this could be could earlier if there is validation on the well location in the manifest

- [x] Task 8: Make description for Tag Set name clearer for what it means

  - Rich C going to think about renaming the column header ("Tag Plate Name")
  - Or add in a text description to top of the manifest
  - Or us the dialog prompt to describe what that col is

- [ ] Task 9: Current Chromium manifest shows dual index tag groups (Spin out to new story)

  - Is there a way to have Currently chromium manifest only show single index tag groups?
  - Create new adapter type "dual_index_tag_plate"
  - Against each Tag Group in the DB, check if it is dual and should update to new adapter type
  - Therefore, Chromium adapter type should then only include single index tag plates
  - Write up as new story:
    - spin out creation of new adapter type to
    - single
    - chromium single/ dual

- [ ] Task 10: Other tests

  - `spec/sample_manifest_excel/upload/row_spec.rb`
  - `spec/data/sample_manifest_excel/manifest_types.yml`
  - `spec/sample_manifest_excel/upload/processor_spec.rb`

- [ ] Questions

- Does it matter which way round i5 and i7 for tag and tag2? Currently i7 is tag and i5 is tag2

- Is there any way to add validation to the excel for Well position
